<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.4"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.4"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><title>Redis数据库总结 | 王霸天的博客</title><meta name="generator" content="Hexo 4.1.1"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Redis数据库总结</h1><a id="logo" href="/.">王霸天的博客</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="search"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Redis数据库总结</h1><div class="post-meta"><a href="/2019/12/28/Redis%E6%95%B0%E6%8D%AE%E5%BA%93%E6%80%BB%E7%BB%93/#comments" class="comment-count"></a><p><span class="date">Dec 28, 2019</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>Hits</i></i></span></p></div><div class="post-content"><h3 id="Redis的安装与使用"><a href="#Redis的安装与使用" class="headerlink" title="Redis的安装与使用"></a>Redis的安装与使用</h3><h4 id="一、前置学习"><a href="#一、前置学习" class="headerlink" title="一、前置学习"></a>一、前置学习</h4><h5 id="1-Linux安装软件"><a href="#1-Linux安装软件" class="headerlink" title="1.Linux安装软件:"></a>1.Linux安装软件:</h5><p>​    以nginx为例</p>
<h6 id="a-包管理工具"><a href="#a-包管理工具" class="headerlink" title="a. 包管理工具"></a>a. 包管理工具</h6><p>​    我们一般情况下使用的使用阿里的CentOS服务器</p>
<p>​        -     yum    CentOS的工具</p>
<p>​                ~ yum search nginx</p>
<p>​                ~ yum install nginx</p>
<p>​                ~ yum erase nginx / yum remove nginx</p>
<p>​                ~ yum list installed | grep nginx</p>
<p>​        -    rpm Redhat的工具</p>
<p>​                ~ rpm -ivh 下载的rpm包文件名</p>
<p>​                ~ rpm -e</p>
<p>​                ~rpm  -qa</p>
<p>​        -    apt    Ubuntu的工具</p>
<h6 id="b-源代码构建安装"><a href="#b-源代码构建安装" class="headerlink" title="b. 源代码构建安装"></a>b. 源代码构建安装</h6><p>​        安装Redis</p>
<p>​        ~ wget <a href="http://download.redis.io/releases/redis-5.0.7.tar.gz" target="_blank" rel="noopener">http://download.redis.io/releases/redis-5.0.7.tar.gz</a></p>
<p>​        ~ gunzip redis-5.0.7.tar.gz</p>
<p>​        ~ tar -xvf redis-5.0.7.tar</p>
<p>​        ~ cd redis-5.0.7</p>
<p>​        ~ make &amp;&amp;make install</p>
<p>​        安装git官方最新版</p>
<p>​        ~ wget <a href="https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.24.1.tar.xz" target="_blank" rel="noopener">https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.24.1.tar.xz</a></p>
<p>​        ~ xz -d  git-2.24.1.tar.xz</p>
<p>​        ~ tar -xvf git-2.24.1.tar</p>
<p>​        ~ cd git-2.24.1</p>
<p>​        ~ make &amp;&amp;make install</p>
<h6 id="c-Linux系统启停服务"><a href="#c-Linux系统启停服务" class="headerlink" title="c. Linux系统启停服务"></a>c. Linux系统启停服务</h6><p>​        systemctl start 服务名     - 开启服务</p>
<p>​        systemctl stop服务名     - 停止服务</p>
<p>​        systemctl restart 服务名     - 重启服务</p>
<p>​        systemctl status 服务名     - 查看服务状态</p>
<p>​        systemctl enable 服务名     - 开机自启</p>
<p>​        systemctl disable 服务名     - 禁止自启</p>
<h6 id="d-ps命令-用于显示当前进程-process-的状态。"><a href="#d-ps命令-用于显示当前进程-process-的状态。" class="headerlink" title="d.  ps命令    - 用于显示当前进程 (process) 的状态。"></a>d.  ps命令    - 用于显示当前进程 (process) 的状态。</h6><p>​        当不清楚redis是否已经开启，或者无法关闭redis需要强行关闭时，可以用该命令查出redis的进程号。</p>
<p>​        ps -ef | grep -E “正则表达式” /grep 字符串 |grep -v 字符串</p>
<p>​        -E后跟正则表达式，</p>
<p>​        -v 不搜索。</p>
<p>​        ps -ef | grep redis-server | grep -v grep | awk ‘{print $2}’         - {print $2} 拿第二列</p>
<p>​        ps -ef | grep redis-server | grep -v grep | awk ‘{print $NF}’        - {print $NF} 拿最后一列</p>
<p>​        ps -ef | grep redis-server | grep -v grep | awk ‘{print $0}’ | xargs kill    - xargs  将行编程列，然后kill所有ps出来的命令</p>
<p>​        pkill “进程名”    -    结束带有进程名的进程</p>
<h5 id="2-Redis相关命令"><a href="#2-Redis相关命令" class="headerlink" title="2. Redis相关命令"></a>2. Redis相关命令</h5><h6 id="1-Redis服务的启动"><a href="#1-Redis服务的启动" class="headerlink" title="1)Redis服务的启动"></a>1)Redis服务的启动</h6><p>​        redis-server –requirepass 123456 –bind ip地址 –port 端口号 &gt;&gt; redis.log &amp; </p>
<p>​        启动redis服务，并且设置密码，重定向到redis.log文件，并且放到后台运行，</p>
<p>​        命令后面加&amp; —–&gt;将命令放后台运行</p>
<p>​        –port 端口号   -设置端口</p>
<p>​        –bind ip地址    - 绑定ip地址(从自身网卡ip选择)</p>
<p>​        –requirepass、–bind、–port、重定向等可选择性书写。</p>
<p>​        </p>
<p>​        jobs     -    查看后台运行命令(手动添加到后台的)</p>
<p>​        fg  %1    -    将后台命令放到前台（占用shell）</p>
<p>​        Ctrl +z    -    将前台命令暂停并放到后台</p>
<p>​        bg  %编号    -    将暂停的命令放在后台运行</p>
<p>​        netstat -ntlp    -    查看正在占用的端口号</p>
<p>​        docker stop 进程名    - 停止正则进行的进程</p>
<p>​        redis-cli -p 端口号 -a 密码  -h 主机</p>
<p>​        设置密码之后用 redis-cli登录也可进如redis命令行模式，但在验证密码前是什么操作都做不了的</p>
<p>​        在redis命令行模式下输入 auth 密码   - -&gt;也可正常登录</p>
<p>​    </p>
<h6 id="2-Redis中："><a href="#2-Redis中：" class="headerlink" title="2) Redis中："></a>2) Redis中：</h6><p>​        shutdown save   - 退出并保存</p>
<p>​        save    bgsave    - 保存</p>
<p>​        select N     -    切换到第N+1个数据库（N范围为0-15）</p>
<p>​        flushdb     -     清空当前数据库的数据</p>
<p>​        flushall     -      清空所有数据库的数据</p>
<p>​        keys *      -      查看所有键</p>
<p>​        dbsize     -      查看数据库大小(键值对数量)</p>
<p>​        exists      -     判断指定的键是否存在</p>
<p>​        type        -     查看键对应值的数据类型</p>
<p>​        ttl 键    -    查看键值对存活时间</p>
<p>​            显示-1    -    说明永不过期</p>
<p>​            显示-2    -    说明已经不存在了</p>
<p>​    </p>
<h6 id="3-Redis中的核心数据类型"><a href="#3-Redis中的核心数据类型" class="headerlink" title="3) Redis中的核心数据类型"></a>3) Redis中的核心数据类型</h6><p>​        a. 字符串</p>
<p>​            set：</p>
<p>​            set  key value ex seconds  –&gt;添加一个键值对，并且设置它的生存时间(秒)</p>
<p>​            setex key seconds value   –&gt; 添加一个键值对，并且设置他的生存时间(秒)</p>
<p>​            set key value nx  –&gt;  若key存在，则设置value，否则不作为</p>
<p>​            setnx key value –&gt;若key存在，则设置value，否则不作为</p>
<p>​            set key value xx –&gt;只在key存在的时候，才对key进行设置操作</p>
<p>​            psetex key milliseconds value –&gt;添加一个键值对，并且设置它的生存时间(毫秒)</p>
<p>​            get :</p>
<p>​            get key  –&gt; 若key存在，那么返回key的value(如果value不是字符串，那莪返回一个错误)，否则返回特殊值<code>nil</code></p>
<p>​            getset key value  –&gt;将key的值设置为value，并返回key在被设置之前的旧值。若key没有旧值，则返回<code>nil</code>,当key存在但不是字符串类型时，返回一个错误。</p>
<p>​            其他操作:</p>
<p>​            strlen key –&gt;返回key储存的字符串值的长度</p>
<p>​            append key value  –&gt;将value追加到key现有值的末尾，若可不存在，则创建新的key和value。</p>
<p>​            setrange key offset value  –&gt;从偏移量offset开始，用value参数复写key存储的字符串值，当key不存在的时候，当空白字符串处理，若偏移量大于原字符串长度，那么超过原字符串的部分用零字节(‘\x00’)进行填充</p>
<p>​            getrange key start end –&gt; 返回key储存的字符串指定部分，从start开始，到end结束(包括start和end)，负偏移量表示从字符串末尾开始技术，-1表示最后一个字符，-2表示倒数第二个。</p>
<p>​        b. 哈希表 - hash</p>
<p>​            hset key field value       –&gt; 添加hash类型键值对</p>
<p>​            hmset key field1 value1 field2 value2 …        –&gt; 添加多组hash类型键值对</p>
<p>​            hget key filed        –&gt; 获取hash类型字段对应的值</p>
<p>​            hmget  key  filed1 filed2…        –&gt; 获取hash类型多个字段对应的值</p>
<p>​            hgetall key        –&gt; 获取hash类型所有的字段和对应的值</p>
<p>​            hkeys key        –&gt; 获取hash类型所有的字段</p>
<p>​            hvals key        –&gt; 获取hash类型所有字段的值</p>
<p>​            hexists key field        –&gt; 判断hash类型某个字段是否存在</p>
<p>​        c. 列表 - list</p>
<p>​            lpush key value1 value2 value3…        —&gt; 在左边添加元素</p>
<p>​            rpush key  value1 value2 value3…        –&gt; 在右边添加元素</p>
<p>​            lpop key        –&gt; 从左边移除一个元素</p>
<p>​            rpop key        –&gt; 从右边移除一个元素</p>
<p>​            lindex key index            –&gt; 查看列表指定位置元素</p>
<p>​            lrange key start end        –&gt; 查看列表指定范围的元素</p>
<p>​            llen key        –&gt; 查看列表元素个数</p>
<p>​            lrem key N value        –&gt; 删除列表中指定元素</p>
<p>​        d. 集合</p>
<p>​            sadd key  value1 value2 value3…        –&gt;添加元素</p>
<p>​            srem key  value1 value2 value3…     –&gt;删除元素</p>
<p>​            spop      –&gt;获取随机元素</p>
<p>​            smembers key        –&gt;查看所有元素</p>
<p>​            scard     –&gt;查看元素个数</p>
<p>​            sismember key value      –&gt; 查看集合中有没有指定元素</p>
<p>​            sinter key1 key2      –&gt; 交集</p>
<p>​            sunion key1 key2    –&gt;并集</p>
<p>​            sdiff key1 key2        –&gt;差集</p>
<p>​        e .有序集合    -    zset</p>
<p>​            zadd key score1 mem1 score2 mem2…        —&gt;添加元素</p>
<p>​            zrem key mem        —&gt;删除元素</p>
<p>​            zrange key start end    —&gt; 升序查看元素</p>
<p>​            zrevrange key start end    —&gt; 降序查看元素</p>
<p>​            zscore key mem    —&gt;查看元素对应的score</p>
<p>​            zincrby key value mem     —&gt;增加元素的score值</p>
<p>​        c. LBS应用  ——  Location-Based Service   —  基于位置服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geoadd locations 104.0763 30.623 libao 104.0652 30.6314 tiyu 104.0736 30.6969 huoche 116.3974 39.9278 tam</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; geodist locations libao huoche</span><br><span class="line">&quot;8223.6542&quot;</span><br><span class="line">127.0.0.1:6379&gt; geodist locations libao huoche km</span><br><span class="line">&quot;8.2237&quot;</span><br><span class="line">127.0.0.1:6379&gt; geodist locations libao tam km</span><br><span class="line">&quot;1521.2837&quot;</span><br><span class="line">127.0.0.1:6379&gt; geodist locations libao tiyu km</span><br><span class="line">&quot;1.4147&quot;</span><br><span class="line">127.0.0.1:6379&gt; georadius locations 104.087606 30.616933 5 km withcoord</span><br><span class="line">1) 1) &quot;libao&quot;</span><br><span class="line">   2) 1) &quot;104.07629996538162231&quot;</span><br><span class="line">      2) &quot;30.62299922484630343&quot;</span><br><span class="line">2) 1) &quot;tiyu&quot;</span><br><span class="line">   2) 1) &quot;104.06520098447799683&quot;</span><br><span class="line">      2) &quot;30.63139929076834989&quot;</span><br><span class="line">127.0.0.1:6379&gt; georadius locations 104.087606 30.616933 5 km</span><br><span class="line">1) &quot;libao&quot;</span><br><span class="line">2) &quot;tiyu&quot;</span><br><span class="line">127.0.0.1:6379&gt; georadius locations 104.087606 30.616933 5 km width dist</span><br><span class="line">(error) ERR syntax error</span><br><span class="line">127.0.0.1:6379&gt; georadius locations 104.087606 30.616933 5 km withdist</span><br><span class="line">1) 1) &quot;libao&quot;</span><br><span class="line">   2) &quot;1.2753&quot;</span><br><span class="line">2) 1) &quot;tiyu&quot;</span><br><span class="line">   2) &quot;2.6810&quot;</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>



<h5 id="二、实际应用"><a href="#二、实际应用" class="headerlink" title="二、实际应用"></a>二、实际应用</h5><ol>
<li><p>准备一个mysql数据库，创建表并存入数据</p>
</li>
<li><p>创建一个python工程</p>
</li>
<li><p>简单应用，直接上代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">序列化：把一个对象变成字符串(str) 或者字节串(bytes)</span></span><br><span class="line"><span class="string">反序列化：把字符串(str) 或者字节串(bytes)还原成对象</span></span><br><span class="line"><span class="string">json - dumps/loads   -基于字符串</span></span><br><span class="line"><span class="string">pickle -  dumps/loads   -基于字节串</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># 连接redis（注意：redis必须开启，否则无法连接）</span></span><br><span class="line">client = redis.Redis(host=<span class="string">'47.98.172.19'</span>, port=<span class="number">6379</span>, password=<span class="string">'123456'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># client.ping()的返回结果是True,，可以用来检测是否连接成功</span></span><br><span class="line"><span class="keyword">if</span> client.ping():</span><br><span class="line">    <span class="comment"># 所有Linux下的redis操作在redis模块下一样</span></span><br><span class="line">    <span class="comment"># 创建字符串键值对</span></span><br><span class="line">    client.set(<span class="string">'username'</span>, <span class="string">'wangx'</span>, ex=<span class="number">1000</span>)</span><br><span class="line">    client.set(<span class="string">'pwd'</span>, <span class="string">'123456'</span>, ex=<span class="number">1000</span>)</span><br><span class="line">    client.set(<span class="string">'gender'</span>, <span class="string">'男'</span>, ex=<span class="number">1000</span>)</span><br><span class="line">    print(client.ttl(<span class="string">'username'</span>))</span><br><span class="line"> 	<span class="comment"># value直接输出的结果将会是字节串，需要转换一下</span></span><br><span class="line">    <span class="comment"># bytes  ---decode('utf-8')---&gt;str</span></span><br><span class="line">    <span class="comment"># str  ----encode('utf-8')---&gt;bytes</span></span><br><span class="line">    <span class="comment"># 字符串</span></span><br><span class="line">    print(client.get(<span class="string">'username'</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    print(client.ttl(<span class="string">'pwd'</span>))</span><br><span class="line">    print(client.get(<span class="string">'pwd'</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="comment"># 列表</span></span><br><span class="line">    client.rpush(<span class="string">'list1'</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    list1 = client.lrange(<span class="string">'list1'</span>, <span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line">    print(list(map(int, list1)))</span><br><span class="line">    <span class="comment"># 集合</span></span><br><span class="line">    client.sadd(<span class="string">'set1'</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>)</span><br><span class="line">    set1 = client.smembers(<span class="string">'set1'</span>)</span><br><span class="line">    print(set(map(int, set1)))</span><br><span class="line">    <span class="comment"># 有序集合</span></span><br><span class="line">    <span class="comment"># zadd的第二个参数是mapping</span></span><br><span class="line">    client.zadd(<span class="string">'zset1'</span>, &#123;</span><br><span class="line">        <span class="string">'小明'</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="string">'小红'</span>: <span class="number">123</span>,</span><br><span class="line">        <span class="string">'小王'</span>: <span class="number">70</span></span><br><span class="line">    &#125;)</span><br><span class="line">    zset1 = client.zrange(<span class="string">'zset1'</span>, <span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line">    print(list(map(bytes.decode, zset1)))</span><br><span class="line">    print(client.zscore(<span class="string">'zset1'</span>, <span class="string">'小明'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'连接失败！！！'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>与mysql结合</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_depts_from_db</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 连接mysql数据库</span></span><br><span class="line">    conn = pymysql.connect(host=<span class="string">'*.*.*.*'</span>, port=<span class="number">3306</span>, user=<span class="string">'root'</span>, password=<span class="string">'123456'</span>, database=<span class="string">'hrs'</span>,charset=<span class="string">'utf8'</span>)</span><br><span class="line">    depts = ()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> conn.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">            <span class="comment"># 查询数据</span></span><br><span class="line">            cursor.execute(<span class="string">'select dno,dname,dloc from tb_dept'</span>)</span><br><span class="line">            <span class="comment"># 将查询结果放入depts中</span></span><br><span class="line">            depts = cursor.fetchall()</span><br><span class="line">            <span class="comment"># 返回depts</span></span><br><span class="line">            <span class="keyword">return</span> depts</span><br><span class="line">    <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> err:</span><br><span class="line">        <span class="comment"># 若数据库出错，返回原因</span></span><br><span class="line">        print(err)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="comment"># 关闭数据库</span></span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 连接redis</span></span><br><span class="line">    client = redis.Redis(host=<span class="string">'*.*.*.*'</span>, port=<span class="number">6379</span>, password=<span class="string">'123456'</span>)</span><br><span class="line">   	<span class="comment"># 获取redis中depts的值</span></span><br><span class="line">    data = client.get(<span class="string">'depts'</span>)</span><br><span class="line">    <span class="comment"># 当值存在，取出值并反序列化</span></span><br><span class="line">    <span class="keyword">if</span> data:</span><br><span class="line">        depts = pickle.loads(data)</span><br><span class="line">    <span class="comment"># 当值不存在</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 从mysql数据库中取出存入depts，</span></span><br><span class="line">        depts = load_depts_from_db()</span><br><span class="line">        <span class="comment"># 在redis中创建键值对</span></span><br><span class="line">        client.set(<span class="string">'depts'</span>, pickle.dumps(depts))</span><br><span class="line">    <span class="comment"># 打印结果</span></span><br><span class="line">    print(depts)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

</li>
</ol>
</div><div class="post-copyright"><blockquote><p>Original author: wangx</p><p>Original link: <a href="http://yoursite.com/2019/12/28/Redis数据库总结/">http://yoursite.com/2019/12/28/Redis数据库总结/</a></p><p>Copyright Notice: Please indicate the source of the reprint (must retain the author's signature and link)</p></blockquote></div><div class="tags"></div><div class="post-share"><div class="social-share"><span>Share:</span></div></div><div class="post-nav"><a href="/2019/12/28/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93/" class="next">MySQL数据库基础总结</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">Contents</i></div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis的安装与使用"><span class="toc-text">Redis的安装与使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#一、前置学习"><span class="toc-text">一、前置学习</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-Linux安装软件"><span class="toc-text">1.Linux安装软件:</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#a-包管理工具"><span class="toc-text">a. 包管理工具</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#b-源代码构建安装"><span class="toc-text">b. 源代码构建安装</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#c-Linux系统启停服务"><span class="toc-text">c. Linux系统启停服务</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#d-ps命令-用于显示当前进程-process-的状态。"><span class="toc-text">d.  ps命令    - 用于显示当前进程 (process) 的状态。</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-Redis相关命令"><span class="toc-text">2. Redis相关命令</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-Redis服务的启动"><span class="toc-text">1)Redis服务的启动</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-Redis中："><span class="toc-text">2) Redis中：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-Redis中的核心数据类型"><span class="toc-text">3) Redis中的核心数据类型</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#二、实际应用"><span class="toc-text">二、实际应用</span></a></li></ol></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/12/28/Redis%E6%95%B0%E6%8D%AE%E5%BA%93%E6%80%BB%E7%BB%93/">Redis数据库总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/28/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93/">MySQL数据库基础总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/20/Linux%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/">Linux定时任务</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/20/shell%E7%BC%96%E7%A8%8B/">shell编程</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/20/Hexo%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/">Hexo博客搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/20/git%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/">git常用指令</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/20/CentOS%207.x%E5%8F%8A%E4%BB%A5%E4%B8%8Amysql%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/">CentOS 7.x及以上mysql安装和配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/20/Linux%E6%97%A5%E5%B8%B8%E6%8C%87%E4%BB%A4/">Linux日常指令</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/20/vim%E7%9A%84%E4%BD%BF%E7%94%A8/">vim的使用</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> Tags</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> Archive</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">9</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Site Map</a> |  <a href="/atom.xml">Subscribe to this site</a> |  <a href="/about/">Contact the blogger</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">wangx.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/" target="_blank" rel="noopener"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.4"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.4" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script></body></html>